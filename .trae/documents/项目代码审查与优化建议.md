# 全流程人工复核计划：生成 5 种策略的审计报告

抱歉遗漏了 `stepwise_long`。确认共有 5 种策略需要审计：
1.  `single` (Single Turn)
2.  `stepwise` (Stepwise)
3.  `stepwise_long` (Stepwise Long Context)
4.  `cot` (Chain of Thought)
5.  `reflection` (Self-Reflection)

## 1. 核心任务：修复与审计

我们将按照“先修复潜在 Bug，再生成审计报告”的顺序执行，确保您看到的报告反映的是修正后的逻辑。

### 1.1 修复 Prompt 加载逻辑 (必要前提)
目前 `src/prompts.py` 存在严重的 Key 冲突风险（所有 YAML 合并到一个字典，同名 Key 会覆盖）。
*   **Action**: 修改 `_load_templates`，将 YAML 内容加载到独立的命名空间（如 `self.templates['single']`, `self.templates['stepwise']`）。

### 1.2 编写审计脚本 `scripts/audit_prompts.py`
使用 `python-docx` 生成一份详细的 Word 文档，模拟 5 种策略的完整对话流程。

**覆盖内容：**
*   **测试样本**: 使用一个固定的 Mock Title/Abstract。
*   **Shot Mode**: 默认展示 `Few-shot` 模式（因为最复杂，最容易出错）。
*   **策略遍历**:
    1.  **Single**: 展示完整的 System Prompt（含 Examples）和 User Prompt。
    2.  **Stepwise**: 展示 Step 1, 2, 3 的完整交互链（System Prompt + History）。
    3.  **Stepwise Long**: 展示第一篇论文的处理流程（同 Stepwise），并模拟**第二篇论文**的处理流程（检查是否携带了第一篇的记忆）。
    4.  **CoT**: 展示包含 `<thinking>` 指令的 System Prompt。
    5.  **Reflection**: 展示 Round 1 和 Round 2 (Critique) 的完整流程。

### 1.3 输出物
*   `Prompt_Audit_Report.docx`: 包含所有策略的实际 Prompt 文本。

## 2. 实施步骤
1.  **添加依赖**: 更新 `requirements.txt` 加入 `python-docx`。
2.  **修复代码**: 修改 `src/prompts.py` 以隔离模板命名空间。
3.  **编写脚本**: 创建并运行 `scripts/audit_prompts.py`。
4.  **交付**: 通知您下载 Word 文档进行审阅。
