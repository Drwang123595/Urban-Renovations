# 提示词优化方案

为了进一步提升大模型在城市更新与空间研究判定任务中的准确度，我制定了以下基于数据驱动和逻辑增强的优化方案。

## 1. 核心优化方向

我们不需要改动代码结构，仅需专注于 `src/templates/` 下的 YAML 文件。优化将围绕以下三个维度展开：

1.  **定义澄清 (Definition Clarity)**: 进一步细化“城市更新”和“空间研究”的边界条件，特别是针对易错的边缘案例（Edge Cases）。
2.  **思维链强化 (CoT Enhancement)**: 在提示词中显式植入更强的推理逻辑，不仅要求结果，更要求“按步骤判别”。
3.  **负样本对抗 (Negative Sampling)**: 在 System Prompt 中增加明确的“排除列表”（Exclusion List），列出常见的误判场景。

## 2. 具体实施计划

### 2.1 优化 `single.yaml` 与 `stepwise.yaml`

**针对 Field 1 (Urban Renewal):**
*   **增加排除项**: 明确指出“单纯的新城建设”、“单纯的房地产开发（无旧改背景）”、“宏观经济讨论”不是城市更新。
*   **增加关键词**: 补充更多细分领域的关键词（如 "brownfield remediation", "slum upgrading", "informal settlement regularization"）。

**针对 Field 2 (Spatial Study):**
*   **强化定义**: 强调“Spatial”必须基于具体的**实地数据**或**案例地**，而非泛泛而谈的“城市问题”。
*   **排除项**: 明确“以某个城市为例但仅做算法测试且无具体空间结论”的研究应慎重判定。

**针对 Field 3 (Spatial Level):**
*   **层级消歧**: 明确当出现“多个城市”时，应归类为“City”还是“Urban Agglomeration”（取决于研究视角是对比还是整体）。

### 2.2 优化 `cot.yaml` (思维链)

*   **结构化思考**: 强制模型在 `<thinking>` 阶段必须回答三个具体问题：
    1.  *研究对象是既有建成环境还是新建区域？*
    2.  *研究是否有具体的地理落脚点？*
    3.  *如果有，空间尺度是什么？*
*   **评分机制显性化**: 提示词中提到的“P score”目前是隐性的，可以要求模型在思考过程中显式打分，低于阈值直接否决。

### 2.3 优化 `reflection.yaml` (自我反思)

*   **针对性追问**: 在 Round 2 的 Critique Prompt 中，增加动态追问（虽然目前是静态 Prompt，但可以写得更具通用攻击性）：
    *   *"Wait, did you check if this is just a general discussion without a specific case study?"*
    *   *"Are you sure this is about UPDATING existing areas, not just building new ones?"*

## 3. 验证方法

*   **A/B 测试**:
    *   保留当前的 Prompt 作为 Baseline (v1)。
    *   创建新版 Prompt (v2)。
    *   使用 `test2.xlsx`（或其他已标注数据）分别运行 v1 和 v2。
    *   使用 `scripts/evaluate.py` 对比 Accuracy 和 F1 Score。

## 4. 立即执行的 Action Item

我将为您直接修改 `src/templates/` 下的 YAML 文件，实施上述优化。

1.  **备份**: 先将现有模板备份为 `src/templates/*.yaml.bak`。
2.  **更新**: 编辑 `single.yaml` 和 `cot.yaml`，植入更强的定义和负样本规则。
