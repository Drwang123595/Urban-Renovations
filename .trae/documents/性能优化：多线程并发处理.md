# 性能优化方案：多策略并行执行

您提出的思路非常有创意且高效：**针对同一篇论文（任务），同时并行执行多种策略（如 Single, CoT, Stepwise），一次性产出多份结果。**

## 1. 可行性评估

*   **技术可行性**: **高**。
    *   我们的架构已经将策略解耦（`StrategyRegistry`），可以轻松实例化多个策略对象。
    *   对于同一输入（Title/Abstract），不同策略之间互不干扰，完全可以并行请求。
*   **收益**:
    *   **时间收益**: 如果您原本计划跑 3 种策略，串行需要 3 倍时间。并行后，时间仅取决于最慢的那个策略（通常是 CoT 或 Stepwise），总耗时接近于只跑一次的时间。
    *   **对比便利性**: 生成的结果可以合并在一个 Excel 的不同列，或者生成多个文件但文件名时间戳一致，方便横向对比。

## 2. 架构调整方案

### 2.1 修改 `DataProcessor`
*   **输入变化**: `strategy` 参数从单字符串改为列表 `List[str]`（例如 `["single", "cot", "stepwise"]`）。
*   **执行逻辑**:
    *   对于每一行数据：
        *   创建一组 `Future`（每个策略一个任务）。
        *   并发调用 API。
        *   收集所有策略的结果。
*   **输出变化**:
    *   **方案 A (推荐)**: 为每个策略生成独立的 Excel 文件（保持现有的文件结构，互不干扰，只是同时跑完了）。
    *   **方案 B**: 生成一个大宽表，包含 `Single_Field1`, `CoT_Field1`...（列太多，不推荐）。
    *   **决策**: 采用 **方案 A**。即运行一次脚本，`output/` 目录下会同时生成 `single_xxx.xlsx`, `cot_xxx.xlsx` 等多个文件。

### 2.2 修改 `main.py`
*   用户交互界面需要支持多选策略（例如输入 `all` 或 `1,3,4`）。

## 3. 实施步骤

1.  **修改 `src/data_processor.py`**:
    *   构造函数接受策略列表。
    *   `run_batch` 内部实例化多个策略对象。
    *   使用 `ThreadPoolExecutor`：
        *   外层循环：遍历论文（保持串行或低并发，避免 API 爆炸）。
        *   内层并发：**对当前论文，同时发起 N 个策略的 API 请求**。
    *   分别维护 N 个结果列表，最后保存 N 个文件。

2.  **修改 `scripts/main.py`**:
    *   更新用户选择逻辑，允许一次选多个策略。

## 4. 潜在风险
*   **API 速率限制**: 如果同时跑 5 种策略，相当于并发度瞬间 x5。需要确保 `MAX_WORKERS`（论文级并发）适当调低，或者依赖 API Client 的重试机制。
*   **建议**: 论文级并发设为 1（串行处理论文），策略级并发设为 N（全并行）。这样对 API 最友好，且逻辑最清晰。

这将极大提升实验效率，让您“一次运行，全览结果”。
