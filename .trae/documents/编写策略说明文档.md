# 策略说明文档编写计划

为了帮助项目管理和持续迭代，我将根据当前的代码逻辑，详细撰写一份 `doc/策略.md` 文档。这份文档将深入解析每种策略的执行机制、提示词设计和上下文管理方式。

## 1. 文档结构设计

文档将包含以下主要部分：

1.  **策略概览 (Overview)**: 简要介绍目前支持的 5 种提取策略。
2.  **策略详情 (Detailed Strategies)**: 针对每种策略的深入技术说明。
    *   **Single Turn (single)**: 单轮对话提取。
    *   **Stepwise (stepwise)**: 分步交互提取（独立上下文）。
    *   **Stepwise Long Context (stepwise_long)**: 分步交互提取（长上下文/跨论文记忆）。
    *   **Chain of Thought (cot)**: 思维链推理提取。
    *   **Self-Reflection (reflection)**: 自我反思/修正提取。
3.  **提示词模式 (Shot Modes)**: 说明 Zero-shot, One-shot, Few-shot 在各策略中的应用。
4.  **扩展指南 (Extensibility)**: 如何代码层面新增策略。

## 2. 策略详情内容草稿 (将写入文档)

### 2.1 Single Turn (`single`)
*   **核心逻辑**: 将所有提取要求（4个字段）打包在一个 Prompt 中，一次性请求模型输出。
*   **代码实现**: `src/strategies/single.py`
*   **上下文**: 每篇论文创建一个新的独立会话（Memory），互不干扰。

### 2.2 Stepwise (`stepwise`)
*   **核心逻辑**: 将任务拆解为 3 个步骤，由程序引导模型逐步回答。
    1.  判断是否为城市更新研究。
    2.  判断是否为空间研究。
    3.  提取空间等级和具体描述。
*   **代码实现**: `src/strategies/stepwise.py`
*   **上下文**: 论文内部保留 3 步的对话历史，但处理完一篇论文后，会话重置，不保留上一篇论文的记忆。

### 2.3 Stepwise Long Context (`stepwise_long`)
*   **核心逻辑**: 步骤同 `stepwise`，但引入了**长上下文记忆**。
*   **代码实现**: `src/strategies/stepwise_long.py`
*   **上下文**: 复用同一个 `ConversationMemory` 实例。模型会“记得”之前处理过的论文，直到 Token 达到上限（128k）才会触发重置。这模拟了“持续学习”或“保持状态”的效果。

### 2.4 Chain of Thought (`cot`)
*   **核心逻辑**: 强制要求模型在输出结果前，先生成一段 `<thinking>` 标签包裹的推理过程。
*   **代码实现**: `src/strategies/cot.py`
*   **解析逻辑**: 代码会忽略 `<thinking>` 内容，只解析最后的 TAB 分隔结果行。
*   **上下文**: 独立会话。

### 2.5 Self-Reflection (`reflection`)
*   **核心逻辑**: 引入“反思”环节，进行两轮对话。
    1.  Round 1: 常规提问，获取初步答案。
    2.  Round 2: 系统自动发送“Critique Prompt”（请检查是否符合定义...），要求模型修正。
*   **代码实现**: `src/strategies/reflection.py`
*   **输出**: 最终采用 Round 2 的输出结果。
*   **上下文**: 独立会话（包含两轮交互历史）。

## 3. 实施步骤

1.  在 `doc/` 目录下创建 `策略.md` 文件。
2.  根据上述分析，用清晰的 Markdown 格式编写内容。
3.  确保文档描述与我刚刚阅读的源码 (`src/strategies/*.py` 和 `src/prompts.py`) 完全一致。

此文档将作为未来开发和评估的基准参考。
